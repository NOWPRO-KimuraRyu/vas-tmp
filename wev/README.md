# 概要

CBM側の最初に読むドキュメントとして記述しています

# 環境構築方法など

本READMEでは詳しく説明しません
基本的に以下の資料を参照して下さい

[サーバー開発手順書>ローカル環境構築フロー](https://docs.google.com/spreadsheets/d/15BuHJNrBVNfbOgPo69__XxwmJC6cPWmdL7B_kTEjkfQ/edit?gid=1827484555#gid=1827484555)

# 大雑把なフォルダ構成

本プロジェクトにおけるフォルダの役割は以下の通りです

（Laravelデフォルト配備のものについては省略気味）

| フォルダ   | 役割                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| app        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ├Domain    | DDD開発におけるDomain層。<br/><br/>CBMのコーディングスタイル上、最も特徴的な役割を果たしている領域で、TBMで言えばapp/Servicesに該当します<br/><br/>関心領域（Domain）毎に区切って、1Domain毎に、主に次の要素で構成することで、オブジェクト指向な開発を目指しています<br/>・Object:登場オブジェクト<br/>・Factory：Objectの生成方法管理（newのロジック化）<br/>・Repository：ObjectのCRUD（DB等との相互変換）<br/>・Service：その他特徴的な手続き型ロジック<br/><br/>Laravelがapp配下に置くような以下要素も、各Domainフォルダに配備するようにしています<br/>・Jobs<br/>・ServiceProvider |
| ├Enums     | Enum関係の定義がすべて入る。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ├Facades   | LaravelのFacade関係の定義がすべて入る。<br/>各Domain配下に置くか未だに迷っている部分ですが、グローバルに参照されるからこそのFacadeなので、暫定この場所に配備しています                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ├Http      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ├Listener  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ├Models    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| └Providers | LaravelデフォルトのServiceProviderが格納される。<br/>Domain固有なものは、ここではなく、各Domain配下に配備しています                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

# 技術選定について

## 意思決定方法

CBMで利用する技術や、コーディングスタイルは、次の二つを天秤にかけて決定されています

- レガシー技術を排して、最新の技術を利用できているか？
- TBMとハレーションを起こさないか？（相互にコードの移植など、ある程度やりやすいか）

この二つは二律背反となるため、技術の選定はバランスを見て決定しています

# これまで選定、意思決定してきた技術

基本的はDomain配下に切り出せるものは、そちらのREADMEに記載するようにしています。

Laravelグローバルで、Domainに配備するのが不自然なものは、本READMEに記載しています

ここで扱うのは以下です

- Vite vs Laravel Mix

## Vite vs Laravel Mix

TBM側ではLaravel Mixを利用していますが
CBM側ではViteを利用することにしました

### Viteを選ぶ理由

- [Laravel12において、Mixはレガシーコードとして非推奨とされている](https://laravel.com/docs/12.x/mix#main-content)
  ため
- TBM⇔CBMのblade/js/cssの相互輸入くらいであれば、それほど問題なくできそうなため

### 実装上の違いについて

ViteもMixも、やっている事は「アセットをどのようにパイプしてフロントに届けるか？」
という関心に対する技術なので
bladeやcss/jsの使い方に違いが生まれるわけではないです

実装上は

- bladeでのcss/jsのインポート方法
- アセットパイプラインの設定方法（vite.config.js vs webpack.mix.js）

等に違いがあります。

TBM側からコードを引っ張ってくるなどした場合
MixとViteの実装上の違いを理解していないと不都合が生じる場合もあり得ます

その場合
[Vite移行ガイド](https://github.com/laravel/vite-plugin/blob/main/UPGRADE.md#migrating-from-laravel-mix-to-vite)を確認してください

Mix⇔Viteの双方向での移行ガイドラインであるため、
二つの実装上の違いを理解しやすいです。
